#!/bin/bash
ROOT_DIR="$(pwd)";

run() {
  echo "$p> $*";
  "$@";
}

for p in *; do
  [ -d "$p/.git" ] || continue;
  cd "$p" >/dev/null || continue;
  run git fetch --all --quiet;
  run git pull --quiet --ff-only;
  [ -e "cpanfile" ] || [ -e "Makefile.PL" ] && [ -n "$CPANM" ] && run $CPANM -n --installdeps .;
  cd "$ROOT_DIR" || exit;
done
